---
import Base from '../layouts/Base.astro';
import { getSiteSettings, getSheetEvents, type SheetEvent } from '../lib/supabase';
import { getCities, getTraditions, TraditionCategory } from '../lib/api';

const settings = await getSiteSettings();
const sheetEvents = await getSheetEvents();

const today = new Date().toISOString().split('T')[0];
const upcoming = sheetEvents
  .filter(e => e.startDate && e.startDate >= today)
  .sort((a, b) => a.startDate.localeCompare(b.startDate))
  .slice(0, 12);

const featured = sheetEvents.slice(0, 6);
const cities = getCities().slice(0, 8);
const traditions = getTraditions();
const rootedTraditions = traditions.filter(t => t.category === TraditionCategory.ROOTED).slice(0, 6);

function formatDate(dateStr: string): { day: string; month: string; year: string } {
  const date = new Date(dateStr);
  return {
    day: String(date.getDate()).padStart(2, '0'),
    month: date.toLocaleDateString('en-GB', { month: 'short' }).toUpperCase(),
    year: String(date.getFullYear())
  };
}

const eventListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Festivals and Cultural Events in Morocco",
  "description": "Complete guide to festivals, cultural events, and celebrations across Morocco",
  "numberOfItems": sheetEvents.length,
  "itemListElement": sheetEvents.slice(0, 20).map((event, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "item": {
      "@type": "Festival",
      "name": event.title_en,
      "startDate": event.startDate,
      "endDate": event.endDate || event.startDate,
      "url": `https://festivalsinmorocco.com/events/${event.slug}`,
      "location": {
        "@type": "Place",
        "name": event.venue || event.city,
        "address": { "@type": "PostalAddress", "addressLocality": event.city, "addressCountry": "MA" }
      }
    }
  }))
};

// Unique cities for FAQ
const uniqueCities = [...new Set(sheetEvents.map(e => e.city))].filter(Boolean);
const freeEvents = sheetEvents.filter(e => e.price_isFree);
const categories = [...new Set(sheetEvents.map(e => e.category))].filter(Boolean);

const homepageFaqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What festivals are held in Morocco?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `Morocco hosts ${sheetEvents.length} annual festivals and cultural events across ${uniqueCities.length} cities, spanning categories including ${categories.join(', ')}. Major festivals include the Gnaoua World Music Festival in Essaouira, Mawazine in Rabat, the Fes Festival of World Sacred Music, Jazzablanca in Casablanca, and the Marrakech International Film Festival.`
      }
    },
    {
      "@type": "Question",
      "name": "When is the best time to visit Morocco for festivals?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Morocco has festivals year-round, but the peak festival season is June through October. Summer brings major music festivals (Gnaoua, Mawazine, Timitar, Jazzablanca), while autumn features MOGA Festival, Visa For Music, and the Marrakech Film Festival. Spring offers the Rose Festival and Fes Sacred Music, and winter includes Yennayer (Amazigh New Year) and the Almond Blossom Festival."
      }
    },
    {
      "@type": "Question",
      "name": "Are there free festivals in Morocco?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `Yes, ${freeEvents.length} of Morocco's ${sheetEvents.length} listed festivals are free to attend. Many heritage celebrations, spiritual moussems, and traditional festivals have free admission, including Yennayer, the Rose Festival, the Cherry Festival, and Mawazine.`
      }
    },
    {
      "@type": "Question",
      "name": "What is a moussem in Morocco?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "A moussem is a traditional Moroccan pilgrimage festival combining religious devotion with cultural celebration. Moussems typically honour a local saint (marabout) and feature music, dance, fantasia horse riding, trade, and communal gatherings. Notable moussems include Moussem Tan Tan (UNESCO-recognized), Moussem of Moulay Idriss, and the Imilchil Marriage Festival."
      }
    },
    {
      "@type": "Question",
      "name": "What is Gnaoua music?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Gnaoua (also spelled Gnawa) is a traditional Moroccan spiritual music tradition with sub-Saharan African roots. It features hypnotic bass rhythms from the guembri (three-stringed lute), iron castanets (qraqeb), and call-and-response chanting. The Gnaoua World Music Festival in Essaouira, held annually in June, is the largest celebration of this tradition."
      }
    }
  ]
};
---

<Base title="Festivals in Morocco — Cultural Events & Celebrations" settings={settings}>
  <script type="application/ld+json" set:html={JSON.stringify(eventListSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(homepageFaqSchema)} />
  
  <!-- ═══════════════════════════════════════════════════════════════════════════
       HERO - Full screen, typographic, gallery aesthetic
  ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="hero" slot="hero">
    {settings.hero_image ? (
      <div class="hero-bg" style={`background-image: url(${settings.hero_image});`}></div>
    ) : (
      <div class="hero-bg hero-bg--gradient"></div>
    )}
    <div class="hero-overlay"></div>
    
    <div class="hero-content">
      <span class="micro-label hero-label">{settings.hero_label || 'Cultural Guide'}</span>
      <h1 class="hero-title">{settings.hero_title || 'Festivals in Morocco'}</h1>
      <p class="hero-subtitle">{settings.hero_subtitle || 'Discover cultural events and celebrations across Morocco'}</p>
      
      <a href="/events" class="btn hero-btn">Explore Events</a>
    </div>

    <div class="hero-stats">
      <div class="stat">
        <span class="stat-number">{upcoming.length}</span>
        <span class="stat-label">Upcoming</span>
      </div>
      <div class="stat">
        <span class="stat-number">{traditions.length}</span>
        <span class="stat-label">Traditions</span>
      </div>
      <div class="stat">
        <span class="stat-number">{cities.length}</span>
        <span class="stat-label">Cities</span>
      </div>
    </div>

    <div class="hero-scroll">
      <span>Scroll</span>
      <div class="scroll-line"></div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       FEATURED - Asymmetric editorial grid
  ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="section section--featured">
    <header class="section-header">
      <div class="section-header__text">
        <span class="micro-label">Selected</span>
        <h2>Featured Events</h2>
      </div>
      <a href="/events" class="view-all">View All</a>
    </header>

    <div class="featured-grid">
      {featured.slice(0, 2).map((event, i) => {
        const date = event.startDate ? formatDate(event.startDate) : null;
        return (
          <a href={`/events/${event.slug}`} class={`featured-card featured-card--${i === 0 ? 'large' : 'medium'}`}>
            <div class="featured-card__image">
              {event.image ? (
                <img src={event.image} alt={event.title_en} loading="lazy" />
              ) : (
                <div class="featured-card__placeholder"></div>
              )}
              <div class="featured-card__overlay"></div>
            </div>
            <div class="featured-card__content">
              {date && (
                <div class="featured-card__date">
                  <span class="date-day">{date.day}</span>
                  <span class="date-month">{date.month}</span>
                </div>
              )}
              <span class="micro-label">{event.category}</span>
              <h3>{event.title_en}</h3>
              <p class="featured-card__location">{event.city}</p>
            </div>
          </a>
        );
      })}
    </div>

    <div class="featured-list">
      {featured.slice(2, 6).map((event) => {
        const date = event.startDate ? formatDate(event.startDate) : null;
        return (
          <a href={`/events/${event.slug}`} class="featured-list__item">
            <div class="featured-list__date">
              {date && (
                <>
                  <span class="date-day">{date.day}</span>
                  <span class="date-month">{date.month}</span>
                </>
              )}
            </div>
            <div class="featured-list__content">
              <span class="micro-label">{event.category}</span>
              <h4>{event.title_en}</h4>
              <p>{event.city}</p>
            </div>
            <div class="featured-list__arrow">→</div>
          </a>
        );
      })}
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       TRADITIONS - Horizontal scroll gallery
  ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="section section--traditions">
    <header class="section-header">
      <div class="section-header__text">
        <span class="micro-label">Heritage</span>
        <h2>Cultural Traditions</h2>
      </div>
      <a href="/traditions" class="view-all">Explore All</a>
    </header>

    <div class="traditions-scroll-wrapper">
      <div class="traditions-scroll" id="traditions-scroll">
        {rootedTraditions.map((tradition, i) => (
          <a href={`/traditions/${tradition.id}`} class="tradition-card">
            <div class="tradition-card__number">{String(i + 1).padStart(2, '0')}</div>
            <h3>{tradition.name}</h3>
            {tradition.name_ar && <span class="tradition-card__ar">{tradition.name_ar}</span>}
            <p>{tradition.description?.slice(0, 80)}...</p>
            <span class="tradition-card__count">{tradition.count} events</span>
          </a>
        ))}
      </div>
      <button class="scroll-arrow scroll-arrow--next" id="traditions-next" aria-label="Next">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       CITIES - Minimal grid with hover inversion
  ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="section section--cities">
    <header class="section-header">
      <div class="section-header__text">
        <span class="micro-label">Locations</span>
        <h2>Cities</h2>
      </div>
      <a href="/cities" class="view-all">All Cities</a>
    </header>

    <div class="cities-grid">
      {cities.map((city) => (
        <a href={`/cities/${city.slug}`} class="city-card">
          <h3>{city.name}</h3>
          <span class="city-card__count">{city.count} events</span>
        </a>
      ))}
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       MAP CTA - Editorial minimal
  ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="section section--map">
    <div class="map-cta">
      <div class="map-cta__content">
        <span class="micro-label">Discover</span>
        <h2>Explore the Map</h2>
        <p>See all festivals and events across Morocco. Plan your route, discover what's happening near you.</p>
        <a href="/map" class="btn">Open Map</a>
      </div>
      <div class="map-cta__visual">
        <div class="map-pattern">
          <span class="dot" style="top: 25%; left: 35%;"></span>
          <span class="dot" style="top: 40%; left: 65%;"></span>
          <span class="dot" style="top: 55%; left: 28%;"></span>
          <span class="dot" style="top: 48%; left: 78%;"></span>
          <span class="dot dot--large" style="top: 62%; left: 40%;"></span>
        </div>
      </div>
    </div>
  </section>
</Base>

<script>
  // Traditions horizontal scroll
  const traditionsScroll = document.getElementById('traditions-scroll');
  const traditionsNext = document.getElementById('traditions-next');
  
  if (traditionsScroll && traditionsNext) {
    traditionsNext.addEventListener('click', () => {
      traditionsScroll.scrollBy({ left: 340, behavior: 'smooth' });
    });
  }

  // Smooth reveal on scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('revealed');
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.section').forEach(section => {
    observer.observe(section);
  });
</script>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════
     HERO - Full screen, gallery aesthetic
  ═══════════════════════════════════════════════════════════════════════════ */
  .hero {
    position: relative;
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    transform: scale(1.02);
    transition: transform 8s var(--ease-out);
  }

  .hero-bg--gradient {
    background: linear-gradient(145deg, #3A3835 0%, #2A2825 50%, #1A1917 100%);
  }

  .hero:hover .hero-bg {
    transform: scale(1);
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(26, 25, 23, 0.2) 0%,
      rgba(26, 25, 23, 0.4) 50%,
      rgba(26, 25, 23, 0.6) 100%
    );
  }

  .hero-content {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: var(--space-md);
    max-width: 800px;
  }

  .hero-label {
    display: block;
    color: rgba(250, 249, 247, 0.6);
    margin-bottom: var(--space-md);
  }

  .hero-title {
    color: var(--paper);
    font-size: clamp(3rem, 10vw, 6rem);
    line-height: 1;
    margin-bottom: var(--space-md);
    letter-spacing: -0.03em;
  }

  .hero-subtitle {
    color: rgba(250, 249, 247, 0.7);
    font-size: 1rem;
    line-height: 1.8;
    margin-bottom: var(--space-lg);
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }

  .hero-btn {
    border-color: var(--paper);
    color: var(--paper);
  }

  .hero-btn:hover {
    background: var(--paper);
    color: var(--ink);
  }

  .hero-stats {
    position: absolute;
    bottom: var(--space-xl);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: var(--space-xl);
    z-index: 1;
  }

  .stat {
    text-align: center;
  }

  .stat-number {
    display: block;
    font-family: var(--font-serif);
    font-size: 2.5rem;
    color: var(--paper);
    line-height: 1;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.625rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgba(250, 249, 247, 0.5);
  }

  .hero-scroll {
    position: absolute;
    bottom: var(--space-md);
    right: var(--space-md);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    z-index: 1;
  }

  .hero-scroll span {
    font-size: 0.625rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgba(250, 249, 247, 0.4);
    writing-mode: vertical-lr;
  }

  .scroll-line {
    width: 1px;
    height: 60px;
    background: linear-gradient(to bottom, rgba(250, 249, 247, 0.4), transparent);
    animation: scrollPulse 2s ease-in-out infinite;
  }

  @keyframes scrollPulse {
    0%, 100% { opacity: 1; transform: scaleY(1); }
    50% { opacity: 0.5; transform: scaleY(0.8); }
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     SECTIONS - Common styles
  ═══════════════════════════════════════════════════════════════════════════ */
  .section {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.8s var(--ease-out), transform 0.8s var(--ease-out);
  }

  .section.revealed {
    opacity: 1;
    transform: translateY(0);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--stone);
  }

  .section-header__text .micro-label {
    display: block;
    margin-bottom: 0.5rem;
  }

  .section-header__text h2 {
    margin: 0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     FEATURED - Asymmetric editorial grid
  ═══════════════════════════════════════════════════════════════════════════ */
  .section--featured {
    padding-top: var(--space-2xl);
  }

  .featured-grid {
    display: grid;
    grid-template-columns: 1.4fr 1fr;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .featured-card {
    display: block;
    position: relative;
    overflow: hidden;
    background: var(--stone);
  }

  .featured-card--large {
    aspect-ratio: 4/5;
  }

  .featured-card--medium {
    aspect-ratio: 3/4;
  }

  .featured-card__image {
    position: absolute;
    inset: 0;
  }

  .featured-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration) var(--ease-out);
  }

  .featured-card__placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(145deg, var(--charcoal) 0%, var(--ink) 100%);
  }

  .featured-card__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(26, 25, 23, 0.8) 0%, rgba(26, 25, 23, 0.2) 50%, transparent 100%);
    transition: background var(--duration) var(--ease-out);
  }

  .featured-card:hover .featured-card__image img {
    transform: scale(1.03);
  }

  .featured-card:hover .featured-card__overlay {
    background: linear-gradient(to top, rgba(26, 25, 23, 0.9) 0%, rgba(26, 25, 23, 0.4) 60%, rgba(26, 25, 23, 0.2) 100%);
  }

  .featured-card__content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: var(--space-md);
    color: var(--paper);
    z-index: 1;
  }

  .featured-card__date {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    text-align: center;
    color: var(--paper);
  }

  .featured-card__date .date-day {
    display: block;
    font-family: var(--font-serif);
    font-size: 2rem;
    line-height: 1;
  }

  .featured-card__date .date-month {
    font-size: 0.625rem;
    letter-spacing: 0.1em;
    opacity: 0.7;
  }

  .featured-card__content .micro-label {
    color: rgba(250, 249, 247, 0.6);
    margin-bottom: 0.5rem;
    display: block;
  }

  .featured-card__content h3 {
    color: var(--paper);
    font-size: 1.75rem;
    margin-bottom: 0.25rem;
  }

  .featured-card--medium .featured-card__content h3 {
    font-size: 1.5rem;
  }

  .featured-card__location {
    font-size: 0.875rem;
    color: rgba(250, 249, 247, 0.6);
  }

  /* Featured List */
  .featured-list {
    display: grid;
    gap: 0;
    border-top: 1px solid var(--stone);
  }

  .featured-list__item {
    display: grid;
    grid-template-columns: 80px 1fr auto;
    gap: var(--space-md);
    padding: var(--space-md) 0;
    border-bottom: 1px solid var(--stone);
    align-items: center;
    transition: background var(--duration) var(--ease-out);
  }

  .featured-list__item:hover {
    background: var(--paper-warm);
    padding-left: var(--space-sm);
    padding-right: var(--space-sm);
    margin: 0 calc(-1 * var(--space-sm));
  }

  .featured-list__date {
    text-align: center;
  }

  .featured-list__date .date-day {
    display: block;
    font-family: var(--font-serif);
    font-size: 1.5rem;
    line-height: 1;
    color: var(--ink);
  }

  .featured-list__date .date-month {
    font-size: 0.625rem;
    letter-spacing: 0.1em;
    color: var(--warm-gray);
  }

  .featured-list__content .micro-label {
    display: block;
    margin-bottom: 0.25rem;
  }

  .featured-list__content h4 {
    font-size: 1.125rem;
    margin-bottom: 0.125rem;
    color: var(--ink);
  }

  .featured-list__content p {
    font-size: 0.8125rem;
    color: var(--warm-gray);
  }

  .featured-list__arrow {
    font-size: 1.25rem;
    color: var(--sand);
    transition: transform var(--duration) var(--ease-out), color var(--duration) var(--ease-out);
  }

  .featured-list__item:hover .featured-list__arrow {
    transform: translateX(4px);
    color: var(--ink);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     TRADITIONS - Horizontal scroll gallery
  ═══════════════════════════════════════════════════════════════════════════ */
  .section--traditions {
    background: var(--paper-warm);
    padding: var(--space-xl) 0;
    margin: 0 calc(-50vw + 50%);
    padding-left: calc(50vw - 50%);
    padding-right: calc(50vw - 50%);
  }

  .traditions-scroll-wrapper {
    position: relative;
  }

  .traditions-scroll {
    display: flex;
    gap: var(--space-md);
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    padding-bottom: var(--space-sm);
  }

  .traditions-scroll::-webkit-scrollbar {
    display: none;
  }

  .tradition-card {
    flex: 0 0 320px;
    scroll-snap-align: start;
    padding: var(--space-md);
    background: var(--paper);
    border: 1px solid var(--stone);
    transition: all var(--duration) var(--ease-out);
  }

  .tradition-card:hover {
    background: var(--ink);
    border-color: var(--ink);
    color: var(--paper);
  }

  .tradition-card__number {
    font-family: var(--font-serif);
    font-size: 0.875rem;
    color: var(--sand);
    margin-bottom: var(--space-md);
    transition: color var(--duration) var(--ease-out);
  }

  .tradition-card:hover .tradition-card__number {
    color: rgba(250, 249, 247, 0.4);
  }

  .tradition-card h3 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
    transition: color var(--duration) var(--ease-out);
  }

  .tradition-card:hover h3 {
    color: var(--paper);
  }

  .tradition-card__ar {
    display: block;
    font-size: 1rem;
    color: var(--warm-gray);
    margin-bottom: var(--space-sm);
    transition: color var(--duration) var(--ease-out);
  }

  .tradition-card:hover .tradition-card__ar {
    color: rgba(250, 249, 247, 0.5);
  }

  .tradition-card p {
    font-size: 0.875rem;
    color: var(--charcoal-soft);
    margin-bottom: var(--space-sm);
    line-height: 1.6;
    transition: color var(--duration) var(--ease-out);
  }

  .tradition-card:hover p {
    color: rgba(250, 249, 247, 0.7);
  }

  .tradition-card__count {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--terracotta);
    transition: color var(--duration) var(--ease-out);
  }

  .tradition-card:hover .tradition-card__count {
    color: rgba(250, 249, 247, 0.6);
  }

  .scroll-arrow {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--paper);
    border: 1px solid var(--stone);
    cursor: pointer;
    transition: all var(--duration) var(--ease-out);
  }

  .scroll-arrow:hover {
    background: var(--ink);
    border-color: var(--ink);
    color: var(--paper);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     CITIES - Minimal grid with hover inversion
  ═══════════════════════════════════════════════════════════════════════════ */
  .cities-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--stone);
    border: 1px solid var(--stone);
  }

  .city-card {
    padding: var(--space-lg) var(--space-md);
    background: var(--paper);
    text-align: center;
    transition: all var(--duration) var(--ease-out);
  }

  .city-card:hover {
    background: var(--ink);
  }

  .city-card h3 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
    transition: color var(--duration) var(--ease-out);
  }

  .city-card:hover h3 {
    color: var(--paper);
  }

  .city-card__count {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--warm-gray);
    transition: color var(--duration) var(--ease-out);
  }

  .city-card:hover .city-card__count {
    color: rgba(250, 249, 247, 0.5);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     MAP CTA
  ═══════════════════════════════════════════════════════════════════════════ */
  .map-cta {
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 400px;
    border: 1px solid var(--stone);
  }

  .map-cta__content {
    padding: var(--space-xl);
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .map-cta__content .micro-label {
    margin-bottom: 0.5rem;
  }

  .map-cta__content h2 {
    margin-bottom: var(--space-sm);
  }

  .map-cta__content p {
    margin-bottom: var(--space-md);
    color: var(--charcoal-soft);
  }

  .map-cta__visual {
    position: relative;
    background: var(--ink);
    overflow: hidden;
  }

  .map-pattern {
    position: absolute;
    inset: 0;
  }

  .dot {
    position: absolute;
    width: 8px;
    height: 8px;
    background: rgba(250, 249, 247, 0.15);
    border-radius: 50%;
    animation: dotPulse 3s ease-in-out infinite;
  }

  .dot--large {
    width: 16px;
    height: 16px;
    background: var(--terracotta);
    animation-delay: 0.5s;
  }

  @keyframes dotPulse {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     RESPONSIVE
  ═══════════════════════════════════════════════════════════════════════════ */
  @media (max-width: 1024px) {
    .featured-grid {
      grid-template-columns: 1fr 1fr;
    }

    .cities-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .map-cta {
      grid-template-columns: 1fr;
    }

    .map-cta__visual {
      min-height: 200px;
    }
  }

  @media (max-width: 768px) {
    .hero-stats {
      bottom: var(--space-lg);
      gap: var(--space-lg);
    }

    .stat-number {
      font-size: 2rem;
    }

    .hero-scroll {
      display: none;
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-sm);
    }

    .featured-grid {
      grid-template-columns: 1fr;
    }

    .featured-card--large,
    .featured-card--medium {
      aspect-ratio: 4/5;
    }

    .featured-list__item {
      grid-template-columns: 60px 1fr auto;
    }

    .tradition-card {
      flex: 0 0 280px;
    }

    .cities-grid {
      grid-template-columns: 1fr;
    }

    .city-card {
      padding: var(--space-md);
    }
  }

  @media (max-width: 480px) {
    .hero-title {
      font-size: 2.5rem;
    }

    .hero-stats {
      gap: var(--space-md);
    }

    .stat-number {
      font-size: 1.5rem;
    }

    .featured-card__content h3 {
      font-size: 1.25rem;
    }

    .featured-list__date .date-day {
      font-size: 1.25rem;
    }
  }
</style>
